# –í–ò–ú–û–ì–ò –¢–ê –í–°–¢–ê–ù–û–í–õ–ï–ù–ù–Ø –î–õ–Ø –†–ï–ê–õ–¨–ù–û–ì–û –ö–û–ù–¢–†–û–õ–ï–†–ê

## üìã –°–ò–°–¢–ï–ú–ù–Ü –í–ò–ú–û–ì–ò

### –ê–ø–∞—Ä–∞—Ç–Ω—ñ –≤–∏–º–æ–≥–∏:
- **–ö–æ–º–ø'—é—Ç–µ—Ä**: Raspberry Pi 4/5 –∞–±–æ Linux/Windows PC
- **–ü–æ—Ä—Ç**: RS-485/RS-232 –∞–±–æ USB-to-RS485 –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä
- **–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–º'—è—Ç—å**: –º—ñ–Ω—ñ–º—É–º 512MB
- **–ú—ñ—Å—Ü–µ –Ω–∞ –¥–∏—Å–∫—É**: –º—ñ–Ω—ñ–º—É–º 1GB

### –ü—Ä–æ–≥—Ä–∞–º–Ω—ñ –≤–∏–º–æ–≥–∏:
- **Python 3.7+**
- **–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∏** (–≤—Å—Ç–∞–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ):
  - pymodbus
  - pyserial
  - threading (–≤–±—É–¥–æ–≤–∞–Ω–∞)
  - logging (–≤–±—É–¥–æ–≤–∞–Ω–∞)

## üîß –í–°–¢–ê–ù–û–í–õ–ï–ù–ù–Ø

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python –±—ñ–±–ª—ñ–æ—Ç–µ–∫:
```bash
pip install pymodbus pyserial
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ä—Ç—É:
```bash
# –î–ª—è Linux:
sudo chmod 666 /dev/ttyUSB0  # –∞–±–æ –≤–∞—à –ø–æ—Ä—Ç

# –î–ª—è Windows:
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–æ–º–µ—Ä COM-–ø–æ—Ä—Ç—É –≤ –î–∏—Å–ø–µ—Ç—á–µ—Ä—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
```

### 3. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞:
–í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `boiler_controller_real.py` —Ç–∞ –∑–º—ñ–Ω—ñ—Ç—å:
```python
class BoilerConfig:
    # –ó–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à –ø–æ—Ä—Ç:
    MODBUS_PORT = '/dev/ttyUSB0'  # Linux
    # MODBUS_PORT = 'COM3'       # Windows
    
    # –ó–º—ñ–Ω—ñ—Ç—å ID –≤–∞—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é:
    MODBUS_UNIT_ID = 1
    
    # –Ü–Ω—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ...
```

## üîå –ü–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø –î–û FATEK FBs-MA

### –°—Ö–µ–º–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è RS-485:
```
–ö–æ–º–ø'—é—Ç–µ—Ä              FATEK FBs-MA
USB-to-RS485        ‚Üí    RS-485 Port
A+ (TX+)            ‚Üí    A+ (Data+)
B- (TX-)            ‚Üí    B- (Data-)
GND                 ‚Üí    GND
```

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è FATEK:
1. **Communication Settings**:
   - Protocol: Modbus RTU
   - Baudrate: 9600 (–∞–±–æ –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –≤–∞—à—É)
   - Data Bits: 8
   - Stop Bits: 1
   - Parity: None
   - Station ID: 1

2. **Register Mapping** (–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∫–æ–¥—É):
   - IW0-IW6 ‚Üí Holding Registers 0-6
   - IX0.0-IX0.5 ‚Üí Coils 0-5
   - QX0.0-QX0.7 ‚Üí Coils 0-7
   - MX0.0-MX0.4 ‚Üí Coils 0-4

## üöÄ –ó–ê–ü–£–°–ö –ü–†–û–ì–†–ê–ú–ò

### –ë–∞–∑–æ–≤–∏–π –∑–∞–ø—É—Å–∫:
```bash
python3 boiler_controller_real.py
```

### –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ (Linux):
```bash
nohup python3 boiler_controller_real.py > boiler.log 2>&1 &
```

### –ó–∞–ø—É—Å–∫ —è–∫ —Å–µ—Ä–≤—ñ—Å—É (systemd):
```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª —Å–µ—Ä–≤—ñ—Å—É
sudo nano /etc/systemd/system/boiler-controller.service
```

–í–º—ñ—Å—Ç —Ñ–∞–π–ª—É:
```ini
[Unit]
Description=Boiler Controller
After=network.target

[Service]
Type=simple
User=pi
WorkingDirectory=/home/pi/boiler
ExecStart=/usr/bin/python3 /home/pi/boiler/boiler_controller_real.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

–ê–∫—Ç–∏–≤–∞—Ü—ñ—è —Å–µ—Ä–≤—ñ—Å—É:
```bash
sudo systemctl daemon-reload
sudo systemctl enable boiler-controller
sudo systemctl start boiler-controller
```

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –¢–ê –õ–û–ì–£–í–ê–ù–ù–Ø

### –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤:
```bash
tail -f boiler_controller.log
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—É:
```bash
sudo systemctl status boiler-controller
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏:
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Modbus –∑'—î–¥–Ω–∞–Ω–Ω—è
python3 -c "
from pymodbus.client.sync import ModbusSerialClient
client = ModbusSerialClient(method='rtu', port='/dev/ttyUSB0')
if client.connect():
    print('‚úÖ Modbus –∑\'—î–¥–Ω–∞–Ω–Ω—è OK')
    client.close()
else:
    print('‚ùå –ü–æ–º–∏–ª–∫–∞ Modbus')
"
```

## ‚ö†Ô∏è –î–Ü–ê–ì–ù–û–°–¢–ò–ö–ê –¢–ê –ü–†–û–ë–õ–ï–ú–ò

### –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è:
1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Ä—Ç**: `ls /dev/tty*` (Linux) –∞–±–æ –î–∏—Å–ø–µ—Ç—á–µ—Ä –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ (Windows)
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞**: `sudo chmod 666 /dev/ttyUSB0`
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–∞–±–µ–ª—å**: A+ –¥–æ A+, B- –¥–æ B-

### –ü–æ–º–∏–ª–∫–∞ Modbus:
1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**: baudrate, parity, stop bits
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ ID –ø—Ä–∏—Å—Ç—Ä–æ—é**: –º–∞—î –∑–±—ñ–≥–∞—Ç–∏—Å—è –∑ MODBUS_UNIT_ID
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó**: –¥–ª—è –¥–æ–≤–≥–∏—Ö –ª—ñ–Ω—ñ–π –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ä–µ–∑–∏—Å—Ç–æ—Ä–∏ 120Œ©

### –ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤:
1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∞–¥—Ä–µ—Å–∏**: –º–∞—é—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó FATEK
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–∏–ø —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤**: Holding Registers vs Input Registers
3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å**: –Ω–µ –±—ñ–ª—å—à–µ 125 —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤ –∑–∞ —Ä–∞–∑

## üîí –ó–ê–•–ò–°–¢ –¢–ê –ù–ê–î–Ü–ô–ù–Ü–°–¢–¨

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è:
- –ê–≤—Ç–æ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –∑–≤'—è–∑–∫—É
- Watchdog —Ç–∞–π–º–µ—Ä
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Å–∏–≥–Ω–∞–ª—ñ–≤
- –î–µ—Ç–µ–∫—Ç—É–≤–∞–Ω–Ω—è —Ñ—Ä–æ–Ω—Ç—ñ–≤

### –†–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è:
```bash
# –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
cp boiler_controller_real.py backup/boiler_controller_$DATE.py
cp boiler_controller.log backup/boiler_$DATE.log
```

## üì± –í–ï–ë-–Ü–ù–¢–ï–†–§–ï–ô–° (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ Flask:
```bash
pip install flask
```

–ü—Ä–∏–∫–ª–∞–¥ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞:
```python
from flask import Flask, render_template, jsonify
app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/status')
def api_status():
    return jsonify(controller.get_status())
```

## üõ†Ô∏è –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ü–ê–†–ê–ú–ï–¢–†–Ü–í

### –ó–º—ñ–Ω–∞ –ø–æ—Ä–æ–≥—ñ–≤ –∞–≤–∞—Ä—ñ–π:
```python
class BoilerConfig:
    VOLTAGE_TRIP = 400.0     # –ù–∞–ø—Ä—É–≥–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
    TEMP_TRIP = 80.0         # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
    VOLTAGE_RESET = 380.0    # –ù–∞–ø—Ä—É–≥–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
    TEMP_RESET = 75.0        # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è
```

### –ó–º—ñ–Ω–∞ –∞–¥—Ä–µ—Å Modbus:
```python
class BoilerConfig:
    # –ê–¥—Ä–µ—Å–∏ —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤ (–∑–º—ñ–Ω—ñ—Ç—å –ø—ñ–¥ –≤–∞—à—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é)
    ADDR_VOLTAGE = 0         # IW0
    ADDR_BOILER_TEMP = 1     # IW1
    # ... —ñ–Ω—à—ñ –∞–¥—Ä–µ—Å–∏
```

## üìû –¢–ï–•–ù–Ü–ß–ù–ê –ü–Ü–î–¢–†–ò–ú–ö–ê

### –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫:
- –£—Å—ñ –ø–æ–º–∏–ª–∫–∏ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ `boiler_controller.log`
- –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –¥—Ä—É–∫—É—é—Ç—å—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å
- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏ –ª–æ–≥—É—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 100 —Ü–∏–∫–ª—ñ–≤

### –î—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:
```python
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É —Å–∏—Å—Ç–µ–º–∏
status = controller.get_status()
print(f"–°–∫–∞–Ω—É–≤–∞–Ω—å: {status['scan_count']}")
print(f"–ù–∞–ø—Ä—É–≥–∞: {status['sensors']['voltage']}V")
print(f"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: {status['sensors']['boiler_temp']}¬∞C")
print(f"–ö–æ–¥ –∞–≤–∞—Ä—ñ—ó: {status['alarm_code']}")
```

## ‚úÖ –ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è** –≤—Å—ñ—Ö –¥–∞—Ç—á–∏–∫—ñ–≤
2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è** Modbus
3. **–ü—Ä–æ—Ç–µ—Å—Ç—É–π—Ç–µ –≤ —Ä—É—á–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ**
4. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è** –±–µ–∑ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å
5. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥** –ª–æ–≥—ñ–≤
6. **–°—Ç–≤–æ—Ä—ñ—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ñ –∫–æ–ø—ñ—ó** –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

–ì–æ—Ç–æ–≤–æ –¥–æ —Ä–æ–±–æ—Ç–∏! üöÄ
